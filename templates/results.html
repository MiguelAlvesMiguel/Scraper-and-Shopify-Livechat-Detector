<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scraping Results</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
</head>
<body>
    <div class="container mt-5">
        <h1>Results for "{{ query }}"</h1>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>URL</th>
                    <th>Shopify</th>
                    <th>Email</th>
                    <th>Contact Form</th>
                    <th>Live Chat Solution</th>
                </tr>
            </thead>
            <tbody id="results-table-body">
            </tbody>
        </table>
        <img src="{{ url_for('static', filename='live_chat_usage_pie_chart.png') }}" alt="Live Chat Usage Pie Chart" id="pie-chart">
        <a href="{{ url_for('index') }}">Back to Home</a>
    </div>
    <script>
        function fetchUpdates() {
            $.getJSON("{{ url_for('updates') }}", function(data) {
                var tableBody = $("#results-table-body");
                tableBody.empty();
                $.each(data, function(index, item) {
                    var shopify = item.Shopify ? '✅' : '❌';
                    var liveChat = item["Live Chat Solution"] ? '✅' : '❌';
                    var row = $("<tr>");
                    row.append($("<td>").text(item.URL));
                    row.append($("<td>").html(shopify));
                    row.append($("<td>").text(item.Email || 'N/A'));
                    row.append($("<td>").text(item["Contact Form"] || 'N/A'));
                    row.append($("<td>").html(liveChat));
                    tableBody.append(row);
                });
            });
        }
        setInterval(fetchUpdates, 3000);
    </script>
</body>
</html>
